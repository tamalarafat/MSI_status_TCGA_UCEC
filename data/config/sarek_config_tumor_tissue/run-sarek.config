cleanup = false

profiles {
    hilbert {
        params {
            config_profile_description = 'HILBERT'
            // HPC job resources
            max_memory = 200.GB
            max_cpus = 32
            max_time = 72.h
        }
        process {
            // using ZPM project code.
            executor = 'pbspro'
        }
    }
    local {
        params {
            config_profile_description = 'local lenovo computer'
            // Local lenovo resources
            max_memory = 12.GB
            max_cpus = 4
            max_time = 72.h
        }
        process {
            executor = 'local'
        }
    }
    singlenode {
        process {
            executor = 'local'
        }
        params {
            config_profile_description = 'single node'
            // Here use single node resources
            max_memory = 240.GB
            max_cpus = 32
            max_time = 72.h
        }
    }
}

process {
    withName: 'MUTECT2_PAIRED' {
            ext.args   = { params.ignore_soft_clipped_bases ?
                                "--dont-use-soft-clipped-bases true --f1r2-tar-gz ${task.ext.prefix}.f1r2.tar.gz --normal-sample ${meta.normal_id}" :
                                "--f1r2-tar-gz ${task.ext.prefix}.f1r2.tar.gz --normal-sample ${meta.normal_id}" }
    }

    withName: 'FREEBAYES' {
        ext.args   = { '--min-alternate-fraction 0.01 --min-mapping-quality 1' }
        //To make sure no naming conflicts ensure with module BCFTOOLS_SORT & the naming being correct in the output folder
        ext.prefix = { meta.num_intervals <= 1 ? "${meta.id}" : "${meta.id}.${target_bed.simpleName}" }
        ext.when   = { params.tools && params.tools.split(',').contains('freebayes') }
        publishDir = [
            enabled: false
        ]
    }
}
